# 动画效果规范文档

## 1. 动画阶段划分
| 阶段名称 | 时间范围(ms) | 描述 |
|---------|-------------|-----|
| 预处理阶段 | [0-100] | 语法树构建与执行序列生成 |
| 执行流阶段 | [100-500] | 代码逻辑可视化执行过程 |
| 渲染阶段 | [500-800] | Three.js场景渲染输出 |

## 2. 关键可视化元素参数
| 元素类型 | 位置计算函数 | 颜色映射规则 | 动态效果 |
|---------|--------------|-------------|---------|
| 代码块 | calculatePosition | HSL亮度递减 | 淡入缩放 |
| 控制流线 | - | #4A90E2 → #F5A623 | 路径生长动画 |
| 高亮标记 | - | rgba(255,235,59,0.3) | 脉冲效果 |
| 三维网格 | gridPosition(z=0) | #888888(50%透明度) | 持续显示 |
| 变量容器 | cubeMapping | 类型色值映射 | 悬浮微动 |

## 3. 时间轴规范
- 时间戳精度：10ms
- 基准单位：执行步骤(STEP)
- 同步机制：IPC通道『animation-frame』
- 摄像机轨迹：
  - 水平视角：跟随代码执行流自动调整
  - 垂直高度：保持z轴+5单位俯视
  - 聚焦逻辑：自动锁定当前执行步骤所在作用域立方体中心

## 4. 可视化空间规范
### 视角锁定逻辑
- 智能聚焦：当代码行数>200时自动启用
- 聚焦范围：时间轴推荐逻辑任务±3个STEP
- 呈现方式：
  1. 目标区域放大至视口70%
  2. 非焦点区域半透明化(alpha=0.3)

### 函数作用域渲染
| 参数名称 | 默认值 | 描述 |
|---------|-------|-----|
| 立方体尺寸 | 15x15x15 | 基础作用域单位空间 |
| 边缘颜色 | #00FF88 | 发光描边效果 |
| 透明度 | 0.1 | 内部填充透明度 |

## 5. 核心函数接口
### SceneManager.ts
| 函数名 | 输入参数 | 输出对象 | 调用时机 |
|--------|---------|---------|---------|
| initScene | 执行序列JSON | Scene对象 | 解析完成时 |
| renderStep | 时间戳 | 帧状态 | 每50ms |

### CppAnalyzer.ts
| 函数名 | 输入参数 | 输出对象 | 调用时机 |
|--------|---------|---------|---------|
| analyzeStructure | 原始代码 | AST语法树 | 初始化阶段 |
| generateAnimationSteps | timeline数组 | 动画JSON | 预处理完成时 |

## 6. 版本变更记录
| 版本号 | 变更日期 | 修改内容 |
|--------|----------|---------|
| 1.0.0  | YYYY-MM-DD | 初始版本 |
| 1.1.0  | 2023-12-15 | 新增三维空间渲染规范/视角锁定机制/作用域可视化参数 |